function replaceAt(e,t,s){return e.slice(0,t)+s+e.slice(t+1,e.length)}function extractDataFrom(e){let t=e;return t=t.replace(/\.\.\./g,"…"),t=t.replace(/(^)\x22(\s)/g,"$1»$2"),t=t.replace(/(^|\s|\()"/g,"$1«"),t=t.replace(/"(\;|\!|\?|\:|\.|\,|$|\)|\s)/g,"»$1"),t=t.replace(/(?<!»,) - /g," — ")}class LegalNotes{constructor(){this.notes=["Организация признана в России террористической, запрещена на территории РФ.","Организация признана в России экстремистской, запрещена на территории РФ.","Организация, ранее выполнявшая функции иностранного агента, признана в России экстремистской, запрещена на территории РФ.","Организация или физическое лицо, выполняющее функции иностранного агента."],this.codes=["terrorist","t","extremist","e","exino","ei","ino","i"]}numeric(e){switch(e){case"terrorist":case"t":return 1;case"extremist":case"e":return 2;case"exino":case"ei":return 3;case"ino":case"i":return 4}}intextNote(e){let t=this.numeric(e);return t?`<sup>${t}</sup>`:""}footerNote(e){let t=this.numeric(e);if(t)return`<p class="footer-note"><sup>${t}</sup> ${this.notes[t-1]}</p>`}}class LegalCodesReplacer{constructor(){this.footnotes=[],this.result="",this.legalNotes=new LegalNotes}replace(e){this.result=e;for(let e of this.legalNotes.codes){let t=new RegExp(`{${e}}`,"g");this.result.search(t)>0&&(this.footnotes.push(this.legalNotes.footerNote(e)),this.result=this.result.replace(t,this.legalNotes.intextNote(e)))}}clear(){this.footnotes=[],this.result=""}addNotesTo(e){e.insertAdjacentHTML("beforeend",'<section class="footer-notes">');for(let t of this.footnotes)e.insertAdjacentHTML("beforeend",t);e.insertAdjacentHTML("beforeend","</section>")}}Date.prototype.toRusString=function(){return new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"long"}).format(this)+" "+this.getFullYear()+" года"};class DocElements{constructor(){this.title=document.getElementsByTagName("title")[0],this.block=document.getElementById("md"),this.LCR=new LegalCodesReplacer}prepareStructure(){this.header=document.getElementsByTagName("header")[0],this.footer=document.getElementsByTagName("footer")[0];let e=new Date(this.header.innerHTML);this.title.innerText=new Intl.DateTimeFormat("ru-RU",{dateStyle:"short"}).format(new Date(e)),this.header.outerHTML=`\n        <header class="header">\n            <h1 class="date">${e.toRusString()}</h1>\n            <div class="dayofweek">${new Intl.DateTimeFormat("ru-RU",{weekday:"long"}).format(e)}</div>\n        </header>`,this.footer.outerHTML=`<footer class="footer">\n        <p class="footer-links">\n            <a href="daybyday.html" class="footer-link">День за днём</a>\n        </p>\n        <p class="footer-credits">${this.footer.innerHTML}</p>\n        </footer>`}prepareData(){this.data=extractDataFrom(this.block.innerHTML),this.LCR.replace(this.data),this.block.style.display="none",this.block.innerText="",this.data=this.LCR.result}dropFootnotes(){this.LCR.addNotesTo(this.footer),this.LCR.clear(),this.LCR=null}prepareStrings(){this.strings=this.data.split(/\n/g).filter(function(e){return""!=e}),this.data=void 0}pushArticle(){this.article.length>0&&(this.articles.push(`<article class="message">${this.article.join("")}</article>`),this.article=[])}parseStrings(){this.articles=[],this.article=[];let e,t=!1;for(;e=this.strings.shift();)if(e.startsWith("#{begin}"))this.article.push(e.replace("#{begin}",'<div class="messages-closed"><button class="btn-open-close">▲▼</button>'));else if(e.startsWith("#{end}"))this.article.push(e.replace("#{end}","</div>")),this.pushArticle();else if(e.startsWith("#!"))this.article.push('<div class="short">'),this.article.push(e.replace("#!","")),this.article.push("</div>"),this.pushArticle();else if(e.startsWith("##")){let s=e.replace("##",'<div class="message-tags">')+"</div>";t||0===this.article.length||this.pushArticle(),this.article.push(s),t=!1}else if(e.startsWith("#")){let s=e.replace("#",'<h2 class="message-header">')+"</h2>";0!==this.article.length&&this.pushArticle(),this.article.push(s),t=!0}else this.article.push(`<p>${e}</p>`);this.pushArticle()}show(){let e=document.createElement("section");e.innerHTML=this.articles.join(""),this.block.insertAdjacentElement("beforebegin",e),this.block.style.display="none"}do(){this.block&&(this.prepareStructure(),this.prepareData(),this.dropFootnotes(),this.prepareStrings(),this.parseStrings(),this.show())}}(new DocElements).do(),document.querySelectorAll(".btn-open-close").forEach(e=>{e.addEventListener("click",t=>{e.parentNode.classList.toggle("messages-closed"),e.parentNode.classList.toggle("messages-open")})});